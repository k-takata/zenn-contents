---
title: "I²Cを使う (AHT25編)"
---

ここでは、I²Cで温湿度センサーのAHT25から情報を取得してみたいと思います。


## AHT25

AHT25はI²Cで接続する温湿度センサーで、比較的安価で入手可能です。

データシートは、[メーカーの公式ページ](http://aosong.com/m/en/products-61.html)や[秋月電子の商品ページ](https://akizukidenshi.com/catalog/g/gM-16731/)からダウンロード可能です。

値の取得方法も簡単で、データシートに記載の通り、以下の計算式で湿度(RH)や温度(T)を算出できます。

$$
RH[\%] = \frac{S_{RH}}{2^{20}} * 100\%
$$

$$
T[℃] = \frac{S_T}{2^{20}} * 200 - 50
$$

ここで $S_{RH}$ と $S_T$ はAHT25から取得できる、20bitの生の測定値です。

GR-CITRUSでは、mrubyの数値は32bit符号付き整数(int32_t)または32bit浮動小数点数(float)として扱われるようになっており、32bit符号付き整数で表現できない値は自動的に32bit浮動小数点数で扱われます。32bit浮動小数点演算を行った場合、精度が不足する懸念があるため、32bit符号付き整数で行うようにします。

湿度を1000倍にした値 $RH_{1000}$ と、温度を100倍にした値 $T_{100}$ は以下の式で算出できます。(桁数は次章のBME680の仕様に合わせてあります。)

$$
RH_{1000} = \frac{S_{RH} * 625}{2^{15}} * 5
$$

$$
T_{100} = \frac{S_T * 625}{2^{15}} - 5000
$$

さらに、温度と湿度を元に[不快指数](https://ja.wikipedia.org/wiki/%E4%B8%8D%E5%BF%AB%E6%8C%87%E6%95%B0)も算出してみましょう。不快指数(DI: Discomfort Index)は以下の式で算出できます。

$$
DI = 0.81T_{d} + 0.01H(0.99T_{d} - 14.3) + 46.3
$$

先ほどの $RH_{1000}$ と $T_{100}$ を使うと、DIを100倍にした値 $DI_{100}$ は以下の式で算出できます。

$$
DI_{100} = \frac{81 * T_{100} + \frac{RH_{1000} * \frac{99 * T_{100}}{100} - 1430}{1000}}{100} + 4630
$$


## GR-CITRUSとの接続

## プログラム

(あとで書く)
